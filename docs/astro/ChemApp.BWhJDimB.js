import{r as j}from"./index.WFquGv8Z.js";var me={exports:{}},K={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var je;function Te(){if(je)return K;je=1;var t=Symbol.for("react.transitional.element"),o=Symbol.for("react.fragment");function d(l,i,a){var y=null;if(a!==void 0&&(y=""+a),i.key!==void 0&&(y=""+i.key),"key"in i){a={};for(var x in i)x!=="key"&&(a[x]=i[x])}else a=i;return i=a.ref,{$$typeof:t,type:l,key:y,ref:i!==void 0?i:null,props:a}}return K.Fragment=o,K.jsx=d,K.jsxs=d,K}var we;function He(){return we||(we=1,me.exports=Te()),me.exports}var e=He();/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Fe=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(o,d,l)=>l?l.toUpperCase():d.toLowerCase()),ke=t=>{const o=Fe(t);return o.charAt(0).toUpperCase()+o.slice(1)},Ce=(...t)=>t.filter((o,d,l)=>!!o&&o.trim()!==""&&l.indexOf(o)===d).join(" ").trim(),Ve=t=>{for(const o in t)if(o.startsWith("aria-")||o==="role"||o==="title")return!0};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Be={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=j.forwardRef(({color:t="currentColor",size:o=24,strokeWidth:d=2,absoluteStrokeWidth:l,className:i="",children:a,iconNode:y,...x},g)=>j.createElement("svg",{ref:g,...Be,width:o,height:o,stroke:t,strokeWidth:l?Number(d)*24/Number(o):d,className:Ce("lucide",i),...!a&&!Ve(x)&&{"aria-hidden":"true"},...x},[...y.map(([I,v])=>j.createElement(I,v)),...Array.isArray(a)?a:[a]]));/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=(t,o)=>{const d=j.forwardRef(({className:l,...i},a)=>j.createElement(qe,{ref:a,iconNode:o,className:Ce(`lucide-${Re(ke(t))}`,`lucide-${t}`,l),...i}));return d.displayName=ke(t),d};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],We=_("arrow-left",Qe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Je=_("arrow-right",De);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["path",{d:"M20.2 20.2c2.04-2.03.02-7.36-4.5-11.9-4.54-4.52-9.87-6.54-11.9-4.5-2.04 2.03-.02 7.36 4.5 11.9 4.54 4.52 9.87 6.54 11.9 4.5Z",key:"1l2ple"}],["path",{d:"M15.7 15.7c4.52-4.54 6.54-9.87 4.5-11.9-2.03-2.04-7.36-.02-11.9 4.5-4.52 4.54-6.54 9.87-4.5 11.9 2.03 2.04 7.36.02 11.9-4.5Z",key:"1wam0m"}]],Ue=_("atom",Oe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M4.5 3h15",key:"c7n0jr"}],["path",{d:"M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3",key:"m1uhx7"}],["path",{d:"M6 14h12",key:"4cwo0f"}]],Xe=_("beaker",Ye);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],ge=_("check",Ge);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Ke=_("chevron-down",Ze);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],tt=_("chevron-right",et);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],nt=_("circle-alert",st);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Ne=_("circle-check",rt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],it=_("eraser",ot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],lt=_("flag",at);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],dt=_("layers",ct);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],ht=_("loader-circle",xt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],ut=_("lock",mt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=[["path",{d:"M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z",key:"edeuup"}]],gt=_("mouse-pointer-2",ft);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],pt=_("move",yt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],jt=_("pen-tool",bt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]],kt=_("redo",wt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],vt=_("settings",Nt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Ct=_("share-2",St);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],_t=_("trash-2",$t);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],At=_("undo",Mt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],zt=_("x",Et),ve=20,ue={C:"#2d3748",N:"#3182ce",O:"#e53e3e",H:"#718096"},It={C:4,N:3,O:2,H:1,S:2,Cl:1,F:1,P:5,Br:1,I:1},T={add:(t,o)=>({x:t.x+o.x,y:t.y+o.y}),sub:(t,o)=>({x:t.x-o.x,y:t.y-o.y}),scale:(t,o)=>({x:t.x*o,y:t.y*o}),len:t=>Math.sqrt(t.x*t.x+t.y*t.y),norm:t=>{const o=Math.sqrt(t.x*t.x+t.y*t.y);return o===0?{x:0,y:0}:{x:t.x/o,y:t.y/o}},dot:(t,o)=>t.x*o.x+t.y*o.y,cross:(t,o)=>t.x*o.y-t.y*o.x,angle:(t,o)=>Math.acos(Math.max(-1,Math.min(1,T.dot(T.norm(t),T.norm(o)))))},ee=(t,o)=>T.len(T.sub(t,o)),fe=t=>{const o={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉"};return String(t).split("").map(d=>o[d]||d).join("")},Lt=(t,o,d,l)=>{const i=Math.atan2(l-o,d-t),a=Math.PI/6,y=Math.round(i/a)*a,x=40*1.5;return{x:t+Math.cos(y)*x,y:o+Math.sin(y)*x}},Pt=(t,o)=>{const d=o.filter(g=>g.source===t.id||g.target===t.id),l=d.reduce((g,I)=>g+I.type,0),i=It[t.element]||0,a=Math.max(0,i-l);if(t.element==="C")return d.length===0?`CH${fe(4)}`:null;let y=t.element,x="";return a>0&&(t.element==="H"?x+=fe(2):x+="H",a>1&&(x+=fe(a))),l===0&&t.element!=="N"&&t.element!=="H"?x+y:y+x},$e=(t,o)=>{if(t.length===0)return"";const d={};t.forEach(g=>d[g.id]=[]),o.forEach(g=>{d[g.source]?.push({neighborId:g.target,bondType:g.type}),d[g.target]?.push({neighborId:g.source,bondType:g.type})});const l=new Set,i={};let a=1,y=[];const x=(g,I)=>{l.add(g);const v=t.find(A=>A.id===g);if(!v)return"";let M=v.element;const U=d[g]||[],C=[];for(const A of U){if(A.neighborId===I)continue;const q=A.bondType===3?"#":A.bondType===2?"=":"";l.has(A.neighborId)?(i[A.neighborId]||(i[A.neighborId]=a++),M+=`${q}${i[A.neighborId]}`):C.push(`${q}${x(A.neighborId,g)}`)}if(C.length>0){const A=C.pop();M+=C.map(q=>`(${q})`).join("")+A}return M};return t.forEach(g=>{l.has(g.id)||y.push(x(g.id,null))}),y.join(".")};function Tt({value:t,onChange:o,isReadOnly:d=!1}){const[l,i]=j.useState([]),[a,y]=j.useState([]),[x,g]=j.useState({x:0,y:0,k:1}),[I,v]=j.useState([{atoms:[],bonds:[]}]),[M,U]=j.useState(0),[C,A]=j.useState("draw"),[q,te]=j.useState("C"),[se,ae]=j.useState(""),[E,X]=j.useState(null),[Q,Y]=j.useState(null),[le,ne]=j.useState(null),[O,N]=j.useState(!1),[S,W]=j.useState(null),[Z,c]=j.useState(!1),[f,b]=j.useState(null),L=j.useRef(null);j.useEffect(()=>{if(t&&Array.isArray(t.atoms)&&Array.isArray(t.bonds)){const r=JSON.stringify({atoms:l,bonds:a,historyIndex:M,tool:C,activeElement:q}),n=JSON.stringify({atoms:t.atoms,bonds:t.bonds,historyIndex:t.historyIndex??M,tool:t.tool??C,activeElement:t.activeElement??q,view:t.view??x});r!==n&&(t.atoms&&i(t.atoms),t.bonds&&y(t.bonds),t.history&&v(t.history),typeof t.historyIndex=="number"&&U(t.historyIndex),t.tool&&A(t.tool),t.activeElement&&te(t.activeElement),t.view&&g(t.view))}},[t]);const w=(s={})=>{o&&o({atoms:s.atoms??l,bonds:s.bonds??a,history:s.history??I,historyIndex:s.historyIndex??M,tool:s.tool??C,activeElement:s.activeElement??q,view:s.view??x})},B=(s,r)=>{const n=I.slice(0,M+1);n.push({atoms:s,bonds:r}),v(n),U(n.length-1),i(s),y(r),w({atoms:s,bonds:r,history:n,historyIndex:n.length-1})},ce=()=>{if(M>0){const s=I[M-1];i(s.atoms),y(s.bonds),U(M-1),w({atoms:s.atoms,bonds:s.bonds,historyIndex:M-1})}},_e=()=>{if(M<I.length-1){const s=I[M+1];i(s.atoms),y(s.bonds),U(M+1),w({atoms:s.atoms,bonds:s.bonds,historyIndex:M+1})}},de=s=>{A(s),w({tool:s})},Me=s=>{te(s),A("draw"),w({activeElement:s,tool:"draw"})},ye=(s,r,n=q)=>{const h=Math.random().toString(36).substr(2,9);return{atom:{id:h,x:s,y:r,element:n},id:h}},Ae=()=>{d||B([],[])},pe=s=>{if(!L.current)return{x:0,y:0};const r=L.current.getBoundingClientRect(),n=s.clientX-r.left,h=s.clientY-r.top;return{x:(n-x.x)/x.k,y:(h-x.y)/x.k}},Ee=s=>{if(d)return;const r=1-s.deltaY*.001,n=Math.max(.1,Math.min(5,x.k*r));if(!L.current)return;const h=L.current.getBoundingClientRect(),p=s.clientX-h.left,k=s.clientY-h.top,m=(p-x.x)/x.k,u=(k-x.y)/x.k,$=p-m*n,P=k-u*n,R={x:$,y:P,k:n};g(R),w({view:R})},ze=s=>{if(d)return;const{x:r,y:n}=pe(s),h=l.find(k=>ee(k,{x:r,y:n})<15),p=h?null:a.find(k=>{const m=l.find(G=>G.id===k.source),u=l.find(G=>G.id===k.target);if(!m||!u)return!1;const $=r-m.x,P=n-m.y,R=u.x-m.x,z=u.y-m.y,D=$*R+P*z,H=R*R+z*z;let F=-1;H!==0&&(F=D/H);let V,J;return F<0?(V=m.x,J=m.y):F>1?(V=u.x,J=u.y):(V=m.x+F*R,J=m.y+F*z),Math.sqrt((r-V)*(r-V)+(n-J)*(n-J))<8});if(C!=="draw"&&!h&&!p){c(!0),b({x:s.clientX,y:s.clientY}),s.target.setPointerCapture(s.pointerId);return}if(C==="erase"){if(h){const k=l.filter(u=>u.id!==h.id),m=a.filter(u=>u.source!==h.id&&u.target!==h.id);B(k,m)}else if(p){const k=a.filter(m=>m.id!==p.id);B(l,k)}return}if(C==="select"){h&&(X({id:h.id,x:h.x,y:h.y}),N(!0)),Y({x:r,y:n}),s.target.setPointerCapture(s.pointerId);return}if(C==="draw"){if(h)X({id:h.id,x:h.x,y:h.y});else if(p){const k=u=>u===1?2:u===2?3:1,m=a.map(u=>u.id===p.id?{...u,type:k(u.type)}:u);B(l,m)}else{const{atom:k,id:m}=ye(r,n);i([...l,k]),X({id:m,x:r,y:n})}N(!0)}Y({x:r,y:n}),s.target.setPointerCapture(s.pointerId)},Ie=s=>{if(d)return;if(Z&&f){const n=s.clientX-f.x,h=s.clientY-f.y,p={...x,x:x.x+n,y:x.y+h};g(p),b({x:s.clientX,y:s.clientY});return}const r=pe(s);if(C==="select"&&O&&E){i(n=>n.map(h=>h.id===E.id?{...h,x:r.x,y:r.y}:h)),Y(r);return}if(C==="draw"){if(!O||!E){const p=l.find(k=>ee(k,r)<15);ne(p?p.id:null);return}const n=Lt(E.x,E.y,r.x,r.y),h=l.find(p=>p.id!==E.id&&(ee(p,r)<ve||ee(p,n)<ve));h?(Y({x:h.x,y:h.y}),W(h.id)):(Y(n),W(null))}},be=s=>{if(!d){if(Z){c(!1),b(null),w({view:x});return}if(C==="select"&&O){B(l,a),N(!1),X(null);return}if(C==="draw"&&O&&E&&Q)if(ee(E,Q)<5){const n=l.find(h=>h.id===E.id);if(n){const h=l.map(p=>p.id===n.id?{...p,element:q}:p);B(h,a)}}else{let n=S,h=[...l];if(!n){const{atom:p,id:k}=ye(Q.x,Q.y);h.push(p),n=k}if(n&&n!==E.id){const p=a.findIndex(m=>m.source===E.id&&m.target===n||m.source===n&&m.target===E.id);let k=[...a];if(p>=0){const m=k[p],u=m.type===1?2:m.type===2?3:1;k[p]={...m,type:u}}else k.push({id:Math.random().toString(36).substr(2,9),source:E.id,target:n,type:1});B(h,k)}else B(h,a)}X(null),N(!1),ne(null),W(null),Y(null)}};j.useEffect(()=>{const s=$e(l,a);ae(s)},[l,a]);const re=(s,r,n,h,p)=>{const k=a.filter(z=>(z.source===s||z.target===s)&&z.id!==h.id).map(z=>{const D=z.source===s?z.target:z.source,H=l.find(V=>V.id===D),F=s===r.id?r:n;return H?T.sub(H,F):{x:0,y:0}}),m=s===r.id?p:T.scale(p,-1);let u=999,$=999,P=!1,R=!1;return k.forEach(z=>{const D=T.cross(p,z),H=T.angle(m,z);D>0?(H<u&&(u=H),P=!0):(H<$&&($=H),R=!0)}),{minRight:u,minLeft:$,existsRight:P,existsLeft:R}},Le=s=>{const r=l.find($=>$.id===s.source),n=l.find($=>$.id===s.target);if(!r||!n)return null;const h=T.sub(n,r),p=T.len(h),k=T.norm(h),m={x:-k.y,y:k.x},u=6;if(s.type===1)return[{x1:r.x,y1:r.y,x2:n.x,y2:n.y}];if(s.type===3&&r.element!=="C"&&n.element!=="C")return[{x1:r.x,y1:r.y,x2:n.x,y2:n.y},{x1:r.x+m.x*u,y1:r.y+m.y*u,x2:n.x+m.x*u,y2:n.y+m.y*u},{x1:r.x-m.x*u,y1:r.y-m.y*u,x2:n.x-m.x*u,y2:n.y-m.y*u}];if(s.type===3){const $=[{x1:r.x,y1:r.y,x2:n.x,y2:n.y}],P=re(r.id,r,n,s,h),R=re(n.id,r,n,s,h);return $.push(...[!0,!1].map(z=>{const D=z?u:-u,H={x:m.x*D,y:m.y*D};let F={x:r.x+H.x,y:r.y+H.y},V={x:n.x+H.x,y:n.y+H.y};const J=Math.min(p*.5,u*Math.tan(Math.PI/2-Math.min(P.minRight,P.minLeft)/2)),G=Math.min(p*.5,u*Math.tan(Math.PI/2-Math.min(R.minRight,R.minLeft)/2)),xe=T.scale(k,J),he=T.scale(k,G);return(z?P.existsRight:P.existsLeft)&&(F=T.add(F,xe)),(z?R.existsRight:R.existsLeft)&&(V=T.sub(V,he)),{x1:F.x,y1:F.y,x2:V.x,y2:V.y}})),$}if(s.type===2&&r.element!=="C"&&n.element!=="C")return[{x1:r.x+m.x*u*.5,y1:r.y+m.y*u*.5,x2:n.x+m.x*u*.5,y2:n.y+m.y*u*.5},{x1:r.x-m.x*u*.5,y1:r.y-m.y*u*.5,x2:n.x-m.x*u*.5,y2:n.y-m.y*u*.5}];if(s.type===2){const $=re(r.id,r,n,s,h),P=re(n.id,r,n,s,h),R=($.existsRight?$.minRight:Math.PI)+(P.existsRight?P.minRight:Math.PI),z=($.existsLeft?$.minLeft:Math.PI)+(P.existsLeft?P.minLeft:Math.PI),D=R<z,H=D?u:-u,F={x:m.x*H,y:m.y*H};let V={x:r.x+F.x,y:r.y+F.y},J={x:n.x+F.x,y:n.y+F.y};const G=Math.min(p*.5,u*Math.tan(Math.PI/2-Math.min($.minRight,$.minLeft)/2)),xe=Math.min(p*.5,u*Math.tan(Math.PI/2-Math.min(P.minRight,P.minLeft)/2)),he=T.scale(k,G),Pe=T.scale(k,xe);return(D?$.existsRight:$.existsLeft)&&(V=T.add(V,he)),(D?P.existsRight:P.existsLeft)&&(J=T.sub(J,Pe)),[{x1:r.x,y1:r.y,x2:n.x,y2:n.y},{x1:V.x,y1:V.y,x2:J.x,y2:J.y}]}return null};return e.jsxs("div",{className:"flex flex-col h-screen w-full bg-gray-50 text-slate-800 font-sans select-none overflow-hidden relative",style:{touchAction:"none"},children:[e.jsxs("header",{className:"flex-none bg-white border-b border-slate-200 p-2 shadow-sm flex flex-wrap gap-2 items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 mr-2",children:[e.jsx("div",{className:"bg-indigo-600 p-1.5 rounded text-white",children:e.jsx(Ue,{size:20})}),e.jsx("h1",{className:"font-bold text-lg hidden sm:block",children:"NanoMol"}),d&&e.jsxs("span",{className:"text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded flex items-center gap-1",children:[e.jsx(ut,{size:10})," Read Only"]})]}),!d&&e.jsxs("div",{className:"flex gap-2 items-center overflow-x-auto no-scrollbar justify-center flex-1",children:[e.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-lg gap-1",children:[e.jsx("button",{onClick:ce,disabled:M===0,className:"w-8 h-8 flex items-center justify-center rounded hover:bg-white disabled:opacity-30 text-gray-600",children:e.jsx(At,{size:16})}),e.jsx("button",{onClick:_e,disabled:M>=I.length-1,className:"w-8 h-8 flex items-center justify-center rounded hover:bg-white disabled:opacity-30 text-gray-600",children:e.jsx(kt,{size:16})})]}),e.jsx("div",{className:"w-px bg-gray-300 h-6"}),e.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-lg gap-1",children:[e.jsx("button",{onClick:()=>de("select"),className:`w-9 h-9 rounded flex items-center justify-center transition-all ${C==="select"?"bg-white shadow text-indigo-600":"text-gray-500 hover:bg-gray-200"}`,children:e.jsx(pt,{size:18})}),e.jsx("button",{onClick:()=>de("draw"),className:`w-9 h-9 rounded flex items-center justify-center transition-all ${C==="draw"?"bg-white shadow text-indigo-600":"text-gray-500 hover:bg-gray-200"}`,children:e.jsx(gt,{size:18})}),e.jsx("button",{onClick:()=>de("erase"),className:`w-9 h-9 rounded flex items-center justify-center transition-all ${C==="erase"?"bg-white shadow text-red-500":"text-gray-500 hover:bg-gray-200"}`,children:e.jsx(it,{size:18})})]})]}),e.jsx("div",{className:"flex gap-2",children:!d&&e.jsx("button",{onClick:Ae,className:"p-2 text-gray-400 hover:text-red-600 rounded",children:e.jsx(_t,{size:18})})})]}),e.jsxs("div",{className:"flex-1 relative overflow-hidden bg-gray-50",children:[e.jsxs("svg",{ref:L,className:`absolute inset-0 w-full h-full block bg-white ${d?"cursor-default":Z?"cursor-grabbing":C==="select"?"cursor-move":"cursor-crosshair"}`,onPointerDown:ze,onPointerMove:Ie,onPointerUp:be,onPointerLeave:be,onWheel:Ee,children:[e.jsx("defs",{children:e.jsx("pattern",{id:"grid",width:"40",height:"40",patternUnits:"userSpaceOnUse",patternTransform:`matrix(${x.k} 0 0 ${x.k} ${x.x} ${x.y})`,children:e.jsx("path",{d:"M 40 0 L 0 0 0 40",fill:"none",stroke:"#f7fafc",strokeWidth:"1"})})}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#grid)"}),e.jsxs("g",{transform:`translate(${x.x}, ${x.y}) scale(${x.k})`,children:[e.jsxs("g",{className:"bonds",children:[a.map(s=>{const r=Le(s);return r?e.jsxs("g",{children:[e.jsx("line",{x1:r[0].x1,y1:r[0].y1,x2:r[0].x2,y2:r[0].y2,stroke:"transparent",strokeWidth:"15"}),r.map((n,h)=>e.jsx("line",{x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,stroke:"#4a5568",strokeWidth:"2.5",strokeLinecap:"round"},h))]},s.id):null}),!d&&O&&E&&Q&&!S&&e.jsx("line",{x1:E.x,y1:E.y,x2:Q.x,y2:Q.y,stroke:"#cbd5e0",strokeWidth:"2",strokeDasharray:"5,5"}),!d&&O&&E&&Q&&S&&e.jsx("line",{x1:E.x,y1:E.y,x2:Q.x,y2:Q.y,stroke:"#3182ce",strokeWidth:"3",opacity:"0.5"})]}),e.jsxs("g",{className:"atoms",children:[l.map(s=>{const r=!d&&le===s.id,n=!d&&S===s.id,h=Pt(s,a),p=h!==null;return e.jsxs("g",{transform:`translate(${s.x}, ${s.y})`,className:"transition-all duration-100",children:[e.jsx("circle",{r:"18",fill:"transparent"}),n&&e.jsx("circle",{r:"18",fill:"transparent",stroke:"#3182ce",strokeWidth:"2",opacity:"0.6",className:"animate-pulse"}),p||r?e.jsxs(e.Fragment,{children:[e.jsx("circle",{r:p?14:6,fill:"white",stroke:r?"#3182ce":p?"white":"#cbd5e0",strokeWidth:p?0:1}),p&&e.jsx("text",{textAnchor:"middle",dy:"0.35em",fill:ue[s.element]||"#000",fontWeight:"bold",fontSize:"16px",style:{pointerEvents:"none",userSelect:"none"},children:h}),!p&&r&&e.jsx("circle",{r:"3",fill:"#cbd5e0"})]}):e.jsx("circle",{r:"2",fill:"transparent"})]},s.id)}),!d&&O&&Q&&C==="draw"&&!S&&e.jsxs("g",{transform:`translate(${Q.x}, ${Q.y})`,opacity:"0.6",style:{pointerEvents:"none"},children:[e.jsx("circle",{r:"12",fill:"white",stroke:"#3182ce",strokeWidth:"2",strokeDasharray:"4,2"}),e.jsx("text",{textAnchor:"middle",dy:"0.35em",fill:ue[q],fontWeight:"bold",children:q})]})]})]})]}),!d&&e.jsxs("div",{className:"absolute right-4 top-4 flex flex-col gap-2 p-2 bg-white rounded-xl shadow-lg border border-gray-100 max-h-[calc(100%-2rem)] overflow-y-auto no-scrollbar",children:[e.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider text-center",children:"Atom"}),Object.keys(ue).map(s=>e.jsx("button",{onClick:()=>Me(s),className:`w-9 h-9 rounded-full font-bold text-sm transition-all flex items-center justify-center ${q===s&&C==="draw"?"bg-indigo-600 text-white shadow-md transform scale-105":"text-gray-500 hover:bg-gray-100 hover:text-indigo-600"}`,children:s},s))]})]}),e.jsx("footer",{className:"bg-white border-t border-slate-200 p-3 text-xs text-gray-500",children:e.jsxs("div",{className:"flex items-center justify-between max-w-3xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold bg-gray-100 px-2 py-1 rounded text-gray-600",children:"SMILES"}),e.jsx("code",{className:"font-mono text-indigo-600 select-all",children:se})]}),e.jsxs("button",{onClick:()=>navigator.clipboard.writeText(se),className:"hover:text-indigo-600 flex items-center gap-1",children:[e.jsx(Ct,{size:14})," ",e.jsx("span",{className:"hidden sm:inline",children:"Copy"})]})]})})]})}const ie=[{id:"inorganic",name:"無機化学",subcategories:[{id:"halogens",name:"ハロゲン"},{id:"transition_metals",name:"遷移元素"},{id:"complex_ions",name:"錯イオン"}]},{id:"theoretical",name:"理論化学",subcategories:[{id:"acid_base",name:"酸と塩基"},{id:"thermochem",name:"熱化学"},{id:"equilibrium",name:"化学平衡"}]},{id:"organic",name:"有機化学",subcategories:[{id:"aliphatic",name:"脂肪族炭化水素"},{id:"aromatic",name:"芳香族化合物"},{id:"polymer",name:"高分子化合物"}]}],Ht=[{id:101,cat:"inorganic",sub:"halogens",difficulty:1},{id:201,cat:"theoretical",sub:"acid_base",difficulty:2},{id:202,cat:"theoretical",sub:"thermochem",difficulty:2},{id:301,cat:"organic",sub:"aliphatic",difficulty:3},{id:302,cat:"organic",sub:"polymer",difficulty:2}],Rt={101:{type:"selection",question:"次のハロゲンに関する記述のうち、**誤りを含むもの**を1つまたは2つ選べ。",maxSelect:2,options:[{text:"フッ素は、常温常圧で淡黄色の気体であり、水と激しく反応して酸素を発生する ($2\\text{F}_2 + 2\\text{H}_2\\text{O} \\to 4\\text{HF} + \\text{O}_2$)。",explanation:"正しい記述です。"},{text:"塩素は、黄緑色の気体であり、強い酸化作用を持つため、ヨウ化カリウムデンプン紙を青変させる。",explanation:"正しい記述です。"},{text:"臭素は、常温で赤褐色の液体であり、唯一の液体元素である。",explanation:"誤り。常温で液体の元素には、臭素($\\text{Br}_2$)のほかに水銀($\\text{Hg}$)があります。"},{text:"ヨウ素は、黒紫色の固体であり、昇華性を有する。",explanation:"正しい記述です。"},{text:"フッ化水素酸は、弱酸であるが、ガラスを腐食する性質を持つため、ポリエチレン容器に保存する。",explanation:"正しい記述です。$\\text{SiO}_2 + 6\\text{HF} \\to \\text{H}_2\\text{SiF}_6 + 2\\text{H}_2\\text{O}$"},{text:"塩化銀は白色沈殿、臭化銀は淡黄色沈殿、ヨウ化銀は黄色沈殿であり、いずれも感光性を持つ。",explanation:"正しい記述です。"}],answers:[2],generalExplanation:"ハロゲンの単体・化合物の性質は頻出です。特に色と状態、反応性は整理しておきましょう。"},201:{type:"numeric",question:"0.10 mol/L の酢酸水溶液の pH を求めよ。ただし、酢酸の電離定数 $K_a = 2.7 \\times 10^{-5}$ mol/L とし、$\\log_{10} 1.6 = 0.20$、$\\log_{10} 1.7 = 0.23$ とする。有効数字2桁で解答せよ。",correctValue:2.78,tolerance:.05,unit:"",generalExplanation:"$[\\text{H}^+] = \\sqrt{cK_a} = \\sqrt{0.10 \\times 2.7 \\times 10^{-5}} = 1.64 \\times 10^{-3}$。$\\text{pH} = -\\log_{10}(1.64 \\times 10^{-3}) = 3 - 0.21 = 2.79$ (厳密解)。"},202:{type:"selection",question:`次の熱化学方程式に関する記述のうち、**正しいもの**を1つ選べ。
$\\text{C}(黒鉛) + 2\\text{H}_2(気) = \\text{CH}_4(気) + 75 \\text{kJ}$`,maxSelect:1,options:[{text:"メタンの生成熱は $75 \\text{kJ}/\\text{mol}$ である。",explanation:"正しい。成分元素の単体から化合物1molが生成する反応であり、発熱反応です。"},{text:"メタンの燃焼熱は $75 \\text{kJ}/\\text{mol}$ である。",explanation:"誤り。これは燃焼反応（酸素との反応）ではありません。"},{text:"黒鉛の燃焼熱と水素の燃焼熱の和は、メタンの燃焼熱より小さい。",explanation:"誤り。ヘスの法則より $Q_{\\text{C}} + 2Q_{\\text{H}_2} = Q_{\\text{f,CH}_4} + Q_{\\text{c,CH}_4}$。"},{text:"この反応は吸熱反応である。",explanation:"誤り。$+75\\text{kJ}$ は発熱を表します。"}],answers:[0],generalExplanation:"熱化学方程式の定義（生成熱、燃焼熱）を正確に把握しているかが問われます。"},301:{type:"structure",question:"分子式 $\\text{C}_2\\text{H}_6\\text{O}$ で表される化合物のうち、ナトリウムと反応して水素を発生するものの構造式を描け。",targetFormula:["CC(C)O","CCCO","C(CC)O","C(C)(C)O"],generalExplanation:"$\\text{C}_2\\text{H}_6\\text{O}$ の異性体にはエタノールとジメチルエーテルがあります。$\\text{Na}$ と反応するのはヒドロキシ基を持つアルコール（エタノール）です。"},302:{type:"selection",question:"合成高分子化合物に関する記述として**正しいもの**を2つ選べ。",maxSelect:2,options:[{text:"ナイロン66は、ヘキサメチレンジアミンとアジピン酸の縮合重合によって得られる。",explanation:"正しい。"},{text:"ポリエチレンテレフタラート(PET)は、エチレングリコールとフタル酸の縮合重合によって得られる。",explanation:"誤り。テレフタル酸を用いる。"},{text:"ポリ乳酸は、乳酸の縮合重合によって得られる生分解性プラスチックである。",explanation:"正しい。"},{text:"天然ゴムは、イソプレンが付加重合した構造を持ち、その幾何異性体はトランス形である。",explanation:"誤り。天然ゴムはシス形ポリイソプレン。"}],answers:[0,2],generalExplanation:""}};class Ft{constructor(){this.cache=new Map}selectQuestionIds(o,d=5){const l=Ht.filter(i=>o.has(i.sub));for(let i=l.length-1;i>0;i--){const a=Math.floor(Math.random()*(i+1));[l[i],l[a]]=[l[a],l[i]]}return l.slice(0,d)}async fetchQuestionsByIds(o){const d=[];for(const l of o){let i=null;if(this.cache.has(l.id)){const y=this.cache.get(l.id).deref();y&&(console.log(`Cache Hit for ${l.id}`),i=y)}if(!i){console.log(`Fetching data for ${l.id}...`);const a=Rt[l.id];a&&(i={...l,...a},this.cache.set(l.id,new WeakRef(i)))}i&&d.push(i)}return d}}const Se=new Ft,oe=({text:t})=>{const[o,d]=j.useState(!1);if(j.useEffect(()=>{if(window.katex){d(!0);return}if(document.getElementById("katex-js")){const i=setInterval(()=>{window.katex&&(d(!0),clearInterval(i))},100);return()=>clearInterval(i)}else{const i=document.createElement("script");i.id="katex-js",i.src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js",i.onload=()=>d(!0),i.onerror=()=>console.error("Failed to load Katex"),document.head.appendChild(i);const a=document.createElement("link");a.rel="stylesheet",a.href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css",document.head.appendChild(a)}},[]),!t)return null;const l=t.split(/(\$[^$]+\$)/g);return e.jsx("span",{children:l.map((i,a)=>{if(i.startsWith("$")&&i.endsWith("$")){const y=i.slice(1,-1);if(!o)return e.jsx("span",{className:"text-gray-400 italic",children:"..."},a);try{const x=window.katex.renderToString(y,{throwOnError:!1,displayMode:!1});return e.jsx("span",{dangerouslySetInnerHTML:{__html:x}},a)}catch{return e.jsx("span",{children:i},a)}}return e.jsx("span",{children:i},a)})})},Vt=({selectedSubCategories:t,onToggleSubCategory:o,onToggleCategory:d})=>{const[l,i]=j.useState(ie.map(y=>y.id)),a=y=>{i(x=>x.includes(y)?x.filter(g=>g!==y):[...x,y])};return e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-slate-700 font-bold",children:[e.jsx(dt,{size:20})," 出題範囲を選択"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:ie.map(y=>{const x=y.subcategories.map(v=>v.id),g=x.every(v=>t.has(v)),I=!g&&x.some(v=>t.has(v));return e.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:`p-3 flex items-center justify-between cursor-pointer hover:bg-slate-50 transition-colors ${g?"bg-blue-50":""}`,onClick:()=>a(y.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:v=>{v.stopPropagation(),d(y)},className:`w-5 h-5 rounded border flex items-center justify-center transition-colors
                      ${g?"bg-blue-600 border-blue-600 text-white":I?"bg-blue-100 border-blue-600 text-blue-600":"border-slate-300 bg-white"}
                    `,children:[g&&e.jsx(ge,{size:14}),I&&e.jsx("div",{className:"w-2.5 h-2.5 bg-blue-600 rounded-sm"})]}),e.jsx("span",{className:"font-bold text-slate-700",children:y.name})]}),l.includes(y.id)?e.jsx(Ke,{size:16,className:"text-slate-400"}):e.jsx(tt,{size:16,className:"text-slate-400"})]}),l.includes(y.id)&&e.jsx("div",{className:"border-t border-slate-100 p-2 bg-slate-50/50",children:y.subcategories.map(v=>e.jsxs("div",{className:"flex items-center gap-3 p-2 hover:bg-blue-50/50 rounded cursor-pointer",onClick:()=>o(v.id),children:[e.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center
                        ${t.has(v.id)?"bg-blue-500 border-blue-500 text-white":"border-slate-300 bg-white"}
                      `,children:t.has(v.id)&&e.jsx(ge,{size:12})}),e.jsx("span",{className:"text-sm text-slate-600",children:v.name})]},v.id))})]},y.id)})})]})};function qt(){const[t,o]=j.useState("start"),[d,l]=j.useState([]),[i,a]=j.useState(0),[y,x]=j.useState(new Set),[g,I]=j.useState({}),[v,M]=j.useState({}),[U,C]=j.useState(!1),[A,q]=j.useState("all");j.useEffect(()=>{const c=new Set;ie.forEach(f=>f.subcategories.forEach(b=>c.add(b.id))),x(c)},[]);const te=c=>{const f=new Set(y);f.has(c)?f.delete(c):f.add(c),x(f)},se=c=>{const f=c.subcategories.map(w=>w.id),b=new Set(y);f.every(w=>b.has(w))?f.forEach(w=>b.delete(w)):f.forEach(w=>b.add(w)),x(b)},ae=async()=>{if(y.size!==0){o("loading");try{const c=Se.selectQuestionIds(y,5);if(c.length===0){alert("選択されたカテゴリに該当する問題がありません。"),o("start");return}const f=await Se.fetchQuestionsByIds(c);l(f),a(0),I({}),M({}),o("quiz")}catch(c){console.error(c),alert("問題の取得に失敗しました。"),o("start")}}},E=(c,f,b)=>{const L=g[c]||[];let w;L.includes(f)?w=L.filter(B=>B!==f):(w=[...L,f],w.length>b&&w.shift()),I({...g,[c]:w})},X=(c,f)=>{const b=v[c]||[],L=b.includes(f)?b.filter(w=>w!==f):[...b,f];M({...v,[c]:L})},Q=(c,f)=>{I({...g,[c]:f})},Y=(c,f)=>{I({...g,[c]:f})},le=()=>{o("result"),a(0)},ne=()=>{let c=0;return d.forEach(f=>{O(f,g[f.id])&&c++}),c},O=(c,f)=>{if(!f)return!1;if(c.type==="selection"){const b=[...f||[]].sort().join(","),L=[...c.answers].sort().join(",");return b===L}else if(c.type==="numeric"){const b=parseFloat(f);return!isNaN(b)&&Math.abs(b-c.correctValue)<=c.tolerance}else if(c.type==="structure")return!f.atoms||f.atoms.length===0?!1:c.targetFormula.includes($e(f.atoms,f.bonds));return!1},N=d[i],S=t==="result",W=S?O(N,g[N.id]):!1,Z=S&&(A==="all"||A==="correct_only"&&W||A==="incorrect_only"&&!W);return e.jsxs("div",{className:"min-h-screen bg-slate-50 text-slate-900 font-sans pb-24",children:[e.jsxs("header",{className:"bg-white border-b border-slate-200 sticky top-0 z-20 shadow-sm",children:[e.jsxs("div",{className:"max-w-4xl mx-auto px-4 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>o("start"),children:[e.jsx("div",{className:"bg-blue-600 p-1.5 rounded text-white",children:e.jsx(Xe,{size:20})}),e.jsx("h1",{className:"font-bold text-lg tracking-tight text-slate-800 hidden sm:block",children:"Chemistry"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t==="result"&&e.jsxs("div",{className:"bg-slate-100 px-3 py-1 rounded-full text-sm font-bold text-slate-700",children:["Score: ",ne()," / ",d.length]}),e.jsx("button",{onClick:()=>C(!U),className:"p-2 text-slate-500 hover:bg-slate-100 rounded-full",children:e.jsx(vt,{size:20})})]})]}),U&&e.jsxs("div",{className:"absolute top-16 right-4 w-64 bg-white shadow-xl border rounded-lg p-4 z-30 animate-in slide-in-from-top-2",children:[e.jsx("h3",{className:"font-bold text-sm text-slate-700 mb-2",children:"解説表示設定"}),e.jsx("div",{className:"space-y-2",children:[{k:"all",l:"常に表示"},{k:"correct_only",l:"正解のみ表示"},{k:"incorrect_only",l:"不正解のみ表示"}].map(c=>e.jsx("button",{onClick:()=>q(c.k),className:`w-full text-left px-3 py-2 text-sm rounded ${A===c.k?"bg-blue-50 text-blue-700 font-semibold":"hover:bg-gray-50"}`,children:c.l},c.k))})]})]}),e.jsxs("main",{className:"max-w-4xl mx-auto px-4 py-8",children:[t==="start"&&e.jsx("div",{className:"animate-in fade-in zoom-in-95 duration-500",children:e.jsxs("div",{className:"bg-white p-6 md:p-10 rounded-2xl shadow-xl border border-slate-100 max-w-3xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"bg-blue-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(jt,{className:"text-blue-600",size:32})}),e.jsx("h2",{className:"text-3xl font-bold mb-2 text-slate-800",children:"化学 実戦演習"}),e.jsx("p",{className:"text-slate-500",children:"演習したい分野を選択してください"})]}),e.jsx(Vt,{selectedSubCategories:y,onToggleSubCategory:te,onToggleCategory:se}),e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("button",{onClick:ae,disabled:y.size===0,className:"w-full md:w-2/3 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white text-lg font-bold py-4 rounded-xl shadow-lg transition-all hover:scale-[1.02]",children:y.size===0?"分野を選択してください":"演習を開始する"})})]})}),t==="loading"&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 animate-in fade-in",children:[e.jsx(ht,{size:48,className:"text-blue-600 animate-spin mb-4"}),e.jsx("p",{className:"text-slate-500 font-medium",children:"問題をデータベースから取得中..."}),e.jsx("p",{className:"text-xs text-slate-400 mt-2",children:"Fetching & Caching via WeakRef..."})]}),(t==="quiz"||t==="result")&&N&&e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsxs("div",{className:`bg-white rounded-xl shadow-sm border overflow-hidden ${S?W?"border-green-200 ring-1 ring-green-100":"border-red-200 ring-1 ring-red-100":"border-slate-200"}`,children:[e.jsxs("div",{className:"bg-slate-800 text-white p-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs font-bold bg-slate-700 px-2 py-1 rounded text-blue-200",children:["Q",i+1]}),e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:gap-2",children:e.jsx("span",{className:"text-sm font-semibold tracking-wider text-slate-300",children:ie.find(c=>c.id===N.cat)?.name})})]}),S&&e.jsx("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-sm font-bold ${W?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:W?e.jsxs(e.Fragment,{children:[e.jsx(ge,{size:16})," 正解"]}):e.jsxs(e.Fragment,{children:[e.jsx(zt,{size:16})," 不正解"]})})]}),e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsx("div",{className:"text-lg md:text-xl font-medium text-slate-800 mb-6 leading-relaxed",children:e.jsx(oe,{text:N.question})}),N.type==="selection"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-xs text-slate-400 font-bold mb-2 uppercase tracking-wide",children:[N.maxSelect,"つまで選択可能"]}),N.options.map((c,f)=>{const b=(g[N.id]||[]).includes(f),L=(v[N.id]||[]).includes(f),w=N.answers.includes(f);let B="border-slate-100 hover:border-blue-300 bg-white";return S?w?B="border-green-500 bg-green-50":b?B="border-red-400 bg-red-50":B="opacity-70 border-slate-100":b&&(B="border-blue-500 bg-blue-50 shadow-sm ring-1 ring-blue-100"),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:`relative flex items-stretch rounded-lg border-2 transition-all ${B}`,children:[e.jsxs("div",{className:`flex-1 p-4 cursor-pointer flex items-start gap-3 ${S?"cursor-default":""}`,onClick:()=>!S&&E(N.id,f,N.maxSelect),children:[e.jsxs("div",{className:`w-6 h-6 rounded border flex items-center justify-center flex-shrink-0 mt-0.5 transition-colors
                                ${b?S?w?"bg-green-500 border-green-500 text-white":"bg-red-500 border-red-500 text-white":"bg-blue-600 border-blue-600 text-white":S&&w?"border-green-500 text-green-600":"border-slate-300"}
                              `,children:[b&&e.jsx(Ne,{size:16}),S&&!b&&w&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"})]}),e.jsx("span",{className:`text-slate-700 ${S&&w?"font-bold text-green-900":""}`,children:e.jsx(oe,{text:c.text})})]}),!S&&e.jsx("button",{onClick:ce=>{ce.stopPropagation(),X(N.id,f)},className:`px-3 border-l hover:bg-slate-50 flex items-center justify-center transition-colors rounded-r-lg
                                  ${L?"text-orange-500 bg-orange-50 border-orange-200":"text-slate-300 border-slate-100"}
                                `,children:e.jsx(lt,{size:18,fill:L?"currentColor":"none"})})]}),Z&&c.explanation&&e.jsxs("div",{className:"ml-10 text-sm text-slate-600 bg-slate-50 p-2 rounded border border-slate-100 mb-2 animate-in fade-in",children:[e.jsx("span",{className:"font-bold text-slate-400 mr-2",children:"解説:"}),e.jsx(oe,{text:c.explanation})]})]},f)})]}),N.type==="numeric"&&e.jsxs("div",{className:"py-4",children:[e.jsx("label",{className:"text-sm text-slate-500 block mb-2",children:"数値を入力:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",step:"any",value:g[N.id]||"",onChange:c=>Q(N.id,c.target.value),disabled:S,className:`w-full md:w-2/3 p-3 text-lg border-2 rounded-lg font-mono outline-none transition-colors
                          ${S?W?"border-green-500 bg-green-50 text-green-900":"border-red-500 bg-red-50 text-red-900":"border-slate-200 focus:border-blue-500"}
                        `,placeholder:"例: 1.23"}),e.jsx("span",{className:"text-slate-500 font-serif",children:N.unit})]}),S&&!W&&e.jsxs("p",{className:"text-sm text-red-600 mt-2 font-bold",children:["正解: ",N.correctValue," (±",N.tolerance,")"]})]}),N.type==="structure"&&e.jsxs("div",{className:"py-2",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-2",children:"構造式を描画:"}),e.jsx(Tt,{value:g[N.id],onChange:c=>Y(N.id,c),isReadOnly:S}),S&&!W&&e.jsx("p",{className:"text-sm text-red-500 mt-2",children:"※ 正しい構造式と比較してください。"})]}),Z&&N.generalExplanation&&e.jsxs("div",{className:"mt-8 pt-6 border-t border-slate-100 animate-in fade-in",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-slate-800 font-bold",children:[e.jsx(nt,{size:20,className:"text-blue-600"}),N.type==="selection"?"補足解説":"解説"]}),e.jsx("div",{className:"bg-slate-50 p-4 rounded-lg text-slate-700 leading-relaxed border border-slate-100",children:e.jsx(oe,{text:N.generalExplanation})})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsxs("button",{onClick:()=>a(c=>Math.max(0,c-1)),disabled:i===0,className:"flex items-center gap-2 px-4 py-2 text-slate-600 hover:bg-white hover:shadow-sm rounded-lg disabled:opacity-30 transition-all",children:[e.jsx(We,{size:20})," 前の問題"]}),!S&&i===d.length-1?e.jsxs("button",{onClick:le,className:"flex items-center gap-2 px-6 py-3 bg-slate-800 hover:bg-slate-900 text-white font-bold rounded-full shadow-lg hover:shadow-xl transition-all hover:scale-105",children:["採点して結果を見る ",e.jsx(Ne,{size:20})]}):e.jsxs("button",{onClick:()=>a(c=>Math.min(d.length-1,c+1)),disabled:i===d.length-1,className:"flex items-center gap-2 px-4 py-2 text-slate-600 hover:bg-white hover:shadow-sm rounded-lg disabled:opacity-30 transition-all",children:["次の問題 ",e.jsx(Je,{size:20})]})]})]},N.id)]}),(t==="quiz"||t==="result")&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 p-4 shadow-lg z-10 safe-area-bottom",children:e.jsx("div",{className:"max-w-4xl mx-auto flex flex-col gap-2",children:e.jsx("div",{className:"flex justify-center flex-wrap gap-2 md:gap-3",children:d.map((c,f)=>{let b="w-3 h-3 md:w-4 md:h-4 rounded-full transition-all duration-300 ";const L=f===i;if(S){const w=O(c,g[c.id]);b+=w?"bg-green-500 ":"bg-red-500 ",L?b+="ring-2 ring-offset-2 ring-slate-400 scale-125":b+="opacity-70 hover:opacity-100"}else{const w=g[c.id]&&(Array.isArray(g[c.id])?g[c.id].length>0:!0);L?b+="bg-blue-600 ring-2 ring-offset-2 ring-blue-200 scale-125":w?b+="bg-blue-300 hover:bg-blue-400":b+="bg-slate-200 hover:bg-slate-300"}return e.jsx("button",{onClick:()=>a(f),className:b,title:`Question ${f+1}`},c.id)})})})})]})}export{qt as default};
